<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta name='viewport' content='width=device-width,initial-scale=1'>
<style>*{box-sizing:border-box}body{font-family:system-ui,sans-serif;margin:0}html,body{overflow:hidden}</style>
<meta name='generator' content='mdx-deck'>
<style data-styled-components="guqeLg kmKUJZ eGsEPm zIEGn enxKql dYzIWH jHprQs bJSzQT hISnYn bIQQAp kVSTZj gjsVpB jKjVCu fhSvky bBrRcM cXgiMa eCoqJu kaUAEP gtARdA hOCGEu fbxTAJ bNhvRs">
/* sc-component-id: sc-bdVaJa */
.sc-bdVaJa {} .eCoqJu{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin-bottom:8px;margin-left:auto;margin-right:auto;} @media print{.eCoqJu{display:none;}}
/* sc-component-id: sc-bwzfXH */
.sc-bwzfXH {} .kaUAEP{-webkit-appearance:none;-moz-appearance:none;appearance:none;border:4px solid transparent;background-clip:padding-box;border-radius:9999px;width:8px;height:8px;color:inherit;opacity:0.5;margin:0px;padding:4px;color:#000;background-color:#000;} .kaUAEP:focus{outline:none;box-shadow:0 0 0 1px;}.gtARdA{-webkit-appearance:none;-moz-appearance:none;appearance:none;border:4px solid transparent;background-clip:padding-box;border-radius:9999px;width:8px;height:8px;color:inherit;opacity:0.125;margin:0px;padding:4px;color:#000;background-color:#000;} .gtARdA:focus{outline:none;box-shadow:0 0 0 1px;}
/* sc-component-id: sc-htpNat */
.sc-htpNat {} .cXgiMa{position:fixed;left:0;right:0;bottom:0;}
/* sc-component-id: sc-bxivhb */
.sc-bxivhb {} .fbxTAJ{cursor:pointer;width:64px;height:100vh;}
/* sc-component-id: sc-ifAKCX */
.sc-ifAKCX {} .hOCGEu{position:fixed;top:0;left:0;bottom:0;}
/* sc-component-id: sc-EHOje */
.sc-EHOje {} .bNhvRs{position:fixed;top:0;right:0;bottom:0;}
/* sc-component-id: sc-bZQynM */
.sc-bZQynM {} .kmKUJZ{overflow-x:hidden;width:100%;height:100%;} @media print{.kmKUJZ{height:auto;overflow-x:visible;}}
/* sc-component-id: sc-gzVnrw */
.sc-gzVnrw {} .eGsEPm{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;width:100%;height:100%;-webkit-transition-property:-webkit-transform;-webkit-transition-property:transform;transition-property:transform;-webkit-transition-timing-function:ease-out;transition-timing-function:ease-out;-webkit-transition-duration:.3s;transition-duration:.3s;-webkit-transform:translateX(0%);-ms-transform:translateX(0%);transform:translateX(0%);} @media print{.eGsEPm{height:auto;display:block;}}
/* sc-component-id: sc-htoDjs */
.sc-htoDjs {} .zIEGn{-webkit-flex:none;-ms-flex:none;flex:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;overflow:hidden;width:100%;height:100%;padding-left:32px;padding-right:32px;} @media print{.zIEGn{width:100vw;height:100vh;page-break-after:always;page-break-inside:avoid;-webkit-print-color-adjust:exact;}} @media screen and (min-width:40em){.zIEGn{padding-left:64px;padding-right:64px;}} @media screen and (min-width:52em){.zIEGn{padding-left:128px;padding-right:128px;}}
/* sc-component-id: sc-dnqmqq */
.sc-dnqmqq {} .guqeLg{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;text-align:left;font-size:16px;width:100vw;height:100vh;color:#000;background-color:#fff;} @media print{.guqeLg{font-size:24px;height:auto;}} @media screen and (min-width:64em){.guqeLg{font-size:32px;}} .guqeLg .Slide > div{min-width:80vw;min-height:60vh;}
/* sc-component-id: sc-fjdhpX */
.sc-fjdhpX {} .dYzIWH{line-height:1.25;font-size:3em;margin-bottom:16px;margin-top:16px;color:heading;}
/* sc-component-id: sc-jzJRlG */
.sc-jzJRlG {}
/* sc-component-id: sc-cSHVUG */
.sc-cSHVUG {} .bJSzQT{line-height:1.25;font-size:2em;margin-bottom:16px;margin-top:16px;color:heading;}
/* sc-component-id: sc-kAzzGY */
.sc-kAzzGY {}
/* sc-component-id: sc-chPdSV */
.sc-chPdSV {} .gjsVpB{line-height:1.25;font-size:1.5em;margin-bottom:16px;margin-top:16px;color:heading;}
/* sc-component-id: sc-kgoBCf */
.sc-kgoBCf {}
/* sc-component-id: sc-hMqMXs */
.sc-hMqMXs {} .bBrRcM{color:#f00;}
/* sc-component-id: sc-kEYyzF */
.sc-kEYyzF {} .fhSvky{font-size:1.5em;}
/* sc-component-id: sc-kkGfuU */
.sc-kkGfuU {} .hISnYn{text-align:left;font-size:1.5em;text-align:left;}
/* sc-component-id: sc-hSdWYo */
.sc-hSdWYo {}
/* sc-component-id: sc-jWBwVP */
.sc-jWBwVP {} .jKjVCu{font-family:Menlo,monospace;color:code;background-color:codeBackground;}</style>
</head>
<body>
<div id=root><div><div class="sc-dnqmqq guqeLg" mode="NORMAL" step="0" width="100vw" height="100vh" color="text"><div class="sc-bZQynM kmKUJZ"><div class="sc-gzVnrw eGsEPm"><div class="sc-htoDjs zIEGn"><div><h1 class="sc-jzJRlG enxKql sc-fjdhpX dYzIWH" font-size="4" color="heading">A DevOps Bake-off üéÇ</h1><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Kubernetes vs. GCP Cloud Functions</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">A bit about me...</h2><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE"><span class="token" style="color:#96CBFE"><span class="token" style="color:#c5c8c6">&lt;</span>SoftwareEngineer</span>
  <span class="token" style="color:#A8FF60">name</span><span class="token" style="color:#F9EE98"><span class="token" style="color:#c5c8c6">=</span><span class="token" style="color:#c5c8c6">&quot;</span>Sam Skjonsberg<span class="token" style="color:#c5c8c6">&quot;</span></span>
  <span class="token" style="color:#A8FF60">location</span><span class="token" style="color:#F9EE98"><span class="token" style="color:#c5c8c6">=</span><span class="token" style="color:#c5c8c6">&quot;</span>Seattle ‚òïÔ∏è<span class="token" style="color:#c5c8c6">&quot;</span></span>
  <span class="token" style="color:#A8FF60">company</span><span class="token" style="color:#F9EE98"><span class="token" style="color:#c5c8c6">=</span><span class="token" style="color:#c5c8c6">&quot;</span>Nordstrom<span class="token" style="color:#c5c8c6">&quot;</span></span>
  <span class="token" style="color:#A8FF60">organization</span><span class="token" style="color:#F9EE98"><span class="token" style="color:#c5c8c6">=</span><span class="token" style="color:#c5c8c6">&quot;</span>Engineering Platform<span class="token" style="color:#c5c8c6">&quot;</span></span>
  <span class="token" style="color:#A8FF60">workedAt</span><span class="token,script,language-javascript"><span class="token,script-punctuation" style="color:#c5c8c6">=</span><span class="token" style="color:#c5c8c6">{</span><span class="token" style="color:#c5c8c6">[</span> <span class="token" style="color:#A8FF60">&quot;AI2&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;Yabbly&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;OpenCar&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;Marchex&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;...&quot;</span><span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">}</span></span>
  <span class="token" style="color:#A8FF60">likes</span><span class="token,script,language-javascript"><span class="token,script-punctuation" style="color:#c5c8c6">=</span><span class="token" style="color:#c5c8c6">{</span><span class="token" style="color:#c5c8c6">[</span> <span class="token" style="color:#A8FF60">&quot;JavaScript&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;Python&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;Docker&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;All things infrastructure&quot;</span> <span class="token" style="color:#c5c8c6">]</span><span class="token" style="color:#c5c8c6">}</span></span> <span class="token" style="color:#c5c8c6">/&gt;</span></span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">A quick primer on Kubernetes:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Declarative mechanism for specifying the infrastructure needed to run software written in
continers (i.e. that user Docker)</li><li class="sc-hSdWYo bIQQAp">Powerful CLI for executing infrastructural operations (rolling out code, scaling, etc)</li><li class="sc-hSdWYo bIQQAp">An opensource project built by Google (and the community)</li><li class="sc-hSdWYo bIQQAp">Requires setting up and maintaining a Kubernetes cluster, which is a collection of individual
machines that Kubernetes distributes work across.</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">GCP Cloud functions in 30 seconds:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Google&#x27;s equivalent of AWS Lambda</li><li class="sc-hSdWYo bIQQAp">Vendor provided service for executing code in response to events</li><li class="sc-hSdWYo bIQQAp">In the HTTP archetype, each request is an &quot;event&quot; which triggers the invocation of your code</li><li class="sc-hSdWYo bIQQAp">&quot;Infinitely&quot; scalable, as Google wires up all the required infrastructure for you</li><li class="sc-hSdWYo bIQQAp"><del>Servers</del></li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Why (I think) you should care:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">We&#x27;re building the airplane while flying it ‚úàÔ∏è</li><li class="sc-hSdWYo bIQQAp">DevOps is the rocket booster launching us out of Earth&#x27;s atmosphere üöÄ</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-kgoBCf kVSTZj sc-chPdSV gjsVpB" font-size="2" color="heading">...but oftentimes we use a glider instead üôÜ‚Äç</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-kgoBCf kVSTZj sc-chPdSV gjsVpB" font-size="2" color="heading">...that we attach a single prop engine to ü§î</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-kgoBCf kVSTZj sc-chPdSV gjsVpB" font-size="2" color="heading">...which we eventually give auto pilot üò¶</h3></div></div><div class="sc-htoDjs zIEGn"><div><h3 class="sc-kgoBCf kVSTZj sc-chPdSV gjsVpB" font-size="2" color="heading">...which inevitably enounters a lot of turbulence üí•</h3></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Patterns I&#x27;ve Encountered</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">The original devops:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Deployment scripts written in perl (so no one could read them, except for the maintainer)</li><li class="sc-hSdWYo bIQQAp">Ultimately just smart wrappers for command line utilities like <code class="sc-jWBwVP jKjVCu" color="code">scp</code>, and <code class="sc-jWBwVP jKjVCu" color="code">initd</code>.</li><li class="sc-hSdWYo bIQQAp">Manual process, executed by engineers</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">The &quot;black box&quot; deployment process:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Separation of Operations and Development personnel</li><li class="sc-hSdWYo bIQQAp">Developers wrote code, didn&#x27;t think too hard about how it ran or how to deploy it</li><li class="sc-hSdWYo bIQQAp">Operations staff deployed and troubleshooted software they didn&#x27;t write</li><li class="sc-hSdWYo bIQQAp">Required a contract defining expected runtime behavior</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">The minimum viable product approach:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Deployment scripts written in bash</li><li class="sc-hSdWYo bIQQAp">Emergence of the CLOUD ‚òÅÔ∏è (bash invoked AWS API endpoints for coordinating cloud resources)</li><li class="sc-hSdWYo bIQQAp">My CTO wrote it, and it worked great...</li><li class="sc-hSdWYo bIQQAp">...but it felt like we were reinventing the wheel everytime we added or changed infrastructural
dependencies</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Early attempts at abstraction</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">People started realizing this was a common problem we needed to solve</li><li class="sc-hSdWYo bIQQAp">A contendor, <code class="sc-jWBwVP jKjVCu" color="code">nixops</code>, arrives</li><li class="sc-hSdWYo bIQQAp">Promises declarative mechanism for orchestration of infrastructure and a read only file system
(infrastructural purity!)</li><li class="sc-hSdWYo bIQQAp">It&#x27;ll be so simple...</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">...every developer&#x27;s famous last words üôÄ...</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Some things worked great:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç Declarative infrastructural requirements expressed in source code</li><li class="sc-hSdWYo bIQQAp">üëç Powerful operator commands for managing and repairing live systems</li><li class="sc-hSdWYo bIQQAp">üëç Read only file system forces prevents &quot;live fixes&quot;</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Others went very poorly:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé Custom configuration / &quot;scripting&quot; language with poor documentation</li><li class="sc-hSdWYo bIQQAp">üëé Often encountered unrecoverable states where we had to nuke n&#x27; pave (which equates to downtime
for our customers)</li><li class="sc-hSdWYo bIQQAp">üëé The <code class="sc-jWBwVP jKjVCu" color="code">//</code> operator merges two objects...WUT</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">But we held to our course...</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Along came Docker and Kubernetes</li><li class="sc-hSdWYo bIQQAp">Quickly ported away from Virtual Box and Nixops</li><li class="sc-hSdWYo bIQQAp">Enjoyed the same benefits (declarative configuration expressed in source code, operational
flexibility)</li><li class="sc-hSdWYo bIQQAp">...and there were docs! üéâ</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Fast forward to the &quot;DevOps Revolution&quot;</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">There are some awesome tools out there now...</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Docker and Kubernetes</li><li class="sc-hSdWYo bIQQAp">Serverless variations like AWS Lambda and GCP Cloud Functions</li><li class="sc-hSdWYo bIQQAp">Terraform</li><li class="sc-hSdWYo bIQQAp">Cloudformation</li><li class="sc-hSdWYo bIQQAp">...and more</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">The paradox of choice strikes:</h2><h3 class="sc-kgoBCf kVSTZj sc-chPdSV gjsVpB" font-size="2" color="heading">Starting a new project or deciding how to update an old system is daunting!</h3></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Let&#x27;s dive into a few things we built, to help this make this all easier to digest</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">What we built:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Both are simple web applications, a HTTP request that results in a payload of HTML, JavaScript and CSS</li><li class="sc-hSdWYo bIQQAp">Non-stateful, data is queried from upstream services / dependencies</li><li class="sc-hSdWYo bIQQAp">Both use <code class="sc-jWBwVP jKjVCu" color="code">React</code> and <code class="sc-jWBwVP jKjVCu" color="code">webpack</code> and are written in JavaScript</li><li class="sc-hSdWYo bIQQAp">Each route is it&#x27;s own &quot;SPA&quot; per-say, rather than one big one</li><li class="sc-hSdWYo bIQQAp">One uses Docker and Kubernetes</li><li class="sc-hSdWYo bIQQAp">Another uses GCP Cloud Functions</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Local Development: Kubernetes</h2></div></div><div class="sc-htoDjs zIEGn"><div><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Docker expresses runtime requirements</li><li class="sc-hSdWYo bIQQAp">Use <code class="sc-jWBwVP jKjVCu" color="code">docker-compose</code> to locally build and run containers</li><li class="sc-hSdWYo bIQQAp">Full emulation of production possible with a local kubernetes cluster</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">const</span> server <span class="token" style="color:#EDEDED">=</span> <span class="token" style="color:#DAD085">express</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span>
<span class="token" style="color:#96CBFE">const</span> port <span class="token" style="color:#EDEDED">=</span> <span class="token" style="color:#FF73FD">3000</span><span class="token" style="color:#c5c8c6">;</span>
server
  <span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#96CBFE">get</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#A8FF60">&#x27;/search&#x27;</span><span class="token" style="color:#c5c8c6">,</span> searchAndRenderResults<span class="token" style="color:#c5c8c6">)</span>
  <span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#96CBFE">get</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#A8FF60">&#x27;/&#x27;</span><span class="token" style="color:#c5c8c6">,</span> renderHome<span class="token" style="color:#c5c8c6">)</span>
  <span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#DAD085">listen</span><span class="token" style="color:#c5c8c6">(</span>port<span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span> <span class="token" style="color:#EDEDED">=&gt;</span> console<span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#DAD085">log</span><span class="token" style="color:#c5c8c6">(</span><span class="token,template-string"><span class="token" style="color:#A8FF60">`listening at http://localhost:</span><span class="token,interpolation"><span class="token,interpolation-punctuation" style="color:#c5c8c6">${</span>port<span class="token,interpolation-punctuation" style="color:#c5c8c6">}</span></span><span class="token" style="color:#A8FF60">`</span></span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">&quot;scripts&quot;</span><span class="token" style="color:#EDEDED">:</span> <span class="token" style="color:#c5c8c6">{</span>
  <span class="token" style="color:#96CBFE">&quot;build&quot;</span><span class="token" style="color:#EDEDED">:</span> <span class="token" style="color:#A8FF60">&quot;webpack&quot;</span><span class="token" style="color:#c5c8c6">,</span>
  <span class="token" style="color:#96CBFE">&quot;start&quot;</span><span class="token" style="color:#EDEDED">:</span> <span class="token" style="color:#A8FF60">&quot;node dist/server&quot;</span><span class="token" style="color:#c5c8c6">,</span>
  <span class="token" style="color:#96CBFE">&quot;start:dev&quot;</span><span class="token" style="color:#EDEDED">:</span> <span class="token" style="color:#A8FF60">&quot;nodemon dist/server&quot;</span>
<span class="token" style="color:#c5c8c6">}</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">FROM</span> node<span class="token" style="color:#c5c8c6">:</span>9.11.1<span class="token" style="color:#c5c8c6">-</span>alpine
<span class="token" style="color:#96CBFE">WORKDIR</span> /webui
<span class="token" style="color:#96CBFE">COPY</span> package.json yarn.lock ./
<span class="token" style="color:#96CBFE">RUN</span> yarn install
<span class="token" style="color:#96CBFE">COPY</span> . .
<span class="token" style="color:#96CBFE">ARG</span> WEBUI_SHA
<span class="token" style="color:#96CBFE">ARG</span> WEBUI_BUILD_DATE
<span class="token" style="color:#96CBFE">ARG</span> NODE_ENV
<span class="token" style="color:#96CBFE">ARG</span> WEBUI_BUILD_TARGETS
<span class="token" style="color:#96CBFE">ENV</span> WEBUI_SHA $<span class="token" style="color:#c5c8c6">{</span>WEBUI_SHA<span class="token" style="color:#c5c8c6">:</span><span class="token" style="color:#c5c8c6">-</span>local<span class="token" style="color:#c5c8c6">}</span>
<span class="token" style="color:#96CBFE">ENV</span> WEBUI_BUILD_DATE $<span class="token" style="color:#c5c8c6">{</span>WEBUI_BUILD_DATE<span class="token" style="color:#c5c8c6">:</span><span class="token" style="color:#c5c8c6">-</span>n/a<span class="token" style="color:#c5c8c6">}</span>
<span class="token" style="color:#96CBFE">ENV</span> NODE_ENV $<span class="token" style="color:#c5c8c6">{</span>NODE_ENV<span class="token" style="color:#c5c8c6">:</span><span class="token" style="color:#c5c8c6">-</span>development<span class="token" style="color:#c5c8c6">}</span>
<span class="token" style="color:#96CBFE">RUN</span> yarn build
<span class="token" style="color:#96CBFE">EXPOSE</span> 3000
<span class="token" style="color:#96CBFE">CMD</span> <span class="token" style="color:#c5c8c6">[</span> <span class="token" style="color:#A8FF60">&quot;yarn&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;start&quot;</span> <span class="token" style="color:#c5c8c6">]</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token,key" style="color:#F9EE98">version</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#A8FF60">&#x27;3&#x27;</span>
<span class="token,key" style="color:#F9EE98">services</span><span class="token" style="color:#c5c8c6">:</span>
  <span class="token,key" style="color:#F9EE98">server</span><span class="token" style="color:#c5c8c6">:</span>
    <span class="token,key" style="color:#F9EE98">build</span><span class="token" style="color:#c5c8c6">:</span>
      <span class="token,key" style="color:#F9EE98">context</span><span class="token" style="color:#c5c8c6">:</span> .
    <span class="token,key" style="color:#F9EE98">env_file</span><span class="token" style="color:#c5c8c6">:</span>
      <span class="token" style="color:#c5c8c6">-</span> ./dev/webui.env
      <span class="token" style="color:#c5c8c6">-</span> ./dev/secrets.webui.env
    <span class="token,key" style="color:#F9EE98">ports</span><span class="token" style="color:#c5c8c6">:</span>
      <span class="token" style="color:#c5c8c6">-</span> <span class="token" style="color:#A8FF60">&quot;3000:3000&quot;</span>
    <span class="token,key" style="color:#F9EE98">depends_on</span><span class="token" style="color:#c5c8c6">:</span>
      <span class="token" style="color:#c5c8c6">-</span> webpack
    <span class="token,key" style="color:#F9EE98">command</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#c5c8c6">[</span> <span class="token" style="color:#A8FF60">&quot;yarn&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;start:dev&quot;</span> <span class="token" style="color:#c5c8c6">]</span>
    <span class="token,key" style="color:#F9EE98">volumes</span><span class="token" style="color:#c5c8c6">:</span>
      <span class="token" style="color:#c5c8c6">-</span> ./src<span class="token" style="color:#c5c8c6">:</span>/webui/src
      <span class="token" style="color:#c5c8c6">-</span> ./dist<span class="token" style="color:#c5c8c6">:</span>/webui/dist
  <span class="token" style="color:#c5c8c6">...</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">  <span class="token" style="color:#c5c8c6">...</span>
  <span class="token,key" style="color:#F9EE98">webpack</span><span class="token" style="color:#c5c8c6">:</span>
      <span class="token,key" style="color:#F9EE98">build</span><span class="token" style="color:#c5c8c6">:</span>
        <span class="token,key" style="color:#F9EE98">context</span><span class="token" style="color:#c5c8c6">:</span> .
      <span class="token,key" style="color:#F9EE98">command</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#c5c8c6">[</span> <span class="token" style="color:#A8FF60">&quot;/webui/node_modules/webpack-cli/bin/cli.js&quot;</span><span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#A8FF60">&quot;--watch&quot;</span> <span class="token" style="color:#c5c8c6">]</span>
      <span class="token,key" style="color:#F9EE98">environment</span><span class="token" style="color:#c5c8c6">:</span>
        <span class="token" style="color:#c5c8c6">-</span> NODE_ENV=$<span class="token" style="color:#c5c8c6">{</span>NODE_ENV<span class="token" style="color:#c5c8c6">:</span><span class="token" style="color:#c5c8c6">-</span>development<span class="token" style="color:#c5c8c6">}</span>
      <span class="token,key" style="color:#F9EE98">volumes</span><span class="token" style="color:#c5c8c6">:</span>
        <span class="token" style="color:#c5c8c6">-</span> ./src<span class="token" style="color:#c5c8c6">:</span>/webui/src
        <span class="token" style="color:#c5c8c6">-</span> ./dist<span class="token" style="color:#c5c8c6">:</span>/webui/dist
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">docker-compose up --build
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Pros</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç Local and production runtimes are &quot;similar but different&quot;</li><li class="sc-hSdWYo bIQQAp">üëç Easy to add additional local services (i.e. MySQL)</li><li class="sc-hSdWYo bIQQAp">üëç Ability to run a full production simulation w/ a local Kubernetes cluster</li><li class="sc-hSdWYo bIQQAp">üëç All you need to get started is Docker</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cons</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé There&#x27;s a lot of configuration</li><li class="sc-hSdWYo bIQQAp">üëé It&#x27;s... &quot;similar but different&quot;</li><li class="sc-hSdWYo bIQQAp">üëé Local management of environment variables and secrets isn&#x27;t super smooth</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Local Development: Google Cloud Functions</h2></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">const</span> server <span class="token" style="color:#EDEDED">=</span> <span class="token" style="color:#DAD085">express</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">;</span>
<span class="token" style="color:#96CBFE">const</span> port <span class="token" style="color:#EDEDED">=</span> <span class="token" style="color:#FF73FD">3000</span><span class="token" style="color:#c5c8c6">;</span>
server
  <span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#96CBFE">get</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#A8FF60">&#x27;/search&#x27;</span><span class="token" style="color:#c5c8c6">,</span> searchAndRenderResults<span class="token" style="color:#c5c8c6">)</span>
  <span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#96CBFE">get</span><span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#A8FF60">&#x27;/&#x27;</span><span class="token" style="color:#c5c8c6">,</span> renderHome<span class="token" style="color:#c5c8c6">)</span>
  <span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#DAD085">listen</span><span class="token" style="color:#c5c8c6">(</span>port<span class="token" style="color:#c5c8c6">,</span> <span class="token" style="color:#c5c8c6">(</span><span class="token" style="color:#c5c8c6">)</span> <span class="token" style="color:#EDEDED">=&gt;</span> console<span class="token" style="color:#c5c8c6">.</span><span class="token" style="color:#DAD085">log</span><span class="token" style="color:#c5c8c6">(</span><span class="token,template-string"><span class="token" style="color:#A8FF60">`listening at http://localhost:</span><span class="token,interpolation"><span class="token,interpolation-punctuation" style="color:#c5c8c6">${</span>port<span class="token,interpolation-punctuation" style="color:#c5c8c6">}</span></span><span class="token" style="color:#A8FF60">`</span></span><span class="token" style="color:#c5c8c6">)</span><span class="token" style="color:#c5c8c6">)</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#96CBFE">&quot;scripts&quot;</span><span class="token" style="color:#EDEDED">:</span> <span class="token" style="color:#c5c8c6">{</span>
  <span class="token" style="color:#96CBFE">&quot;start:dev&quot;</span><span class="token" style="color:#EDEDED">:</span> <span class="token" style="color:#A8FF60">&quot;nodemon dist/server.js&quot;</span>
<span class="token" style="color:#c5c8c6">}</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#DAD085">npm</span> run start:dev
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Pros</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç All you need to get started is the right NodeJS version</li><li class="sc-hSdWYo bIQQAp">üëç No global state / shared stateful architecture (you can&#x27;t even begin to shoot yourself in
the foot with state, kinda)</li><li class="sc-hSdWYo bIQQAp">üëç It&#x27;s all JavaScript (very approachable, no need to understand Docker, Kubernetes, etc)</li><li class="sc-hSdWYo bIQQAp">üëç Minimal configuration</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cons</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé Easy for Node verions to drift between production and local environments</li><li class="sc-hSdWYo bIQQAp">üëé No archetype for providing supporting services (i.e. a persistence layer) locally</li><li class="sc-hSdWYo bIQQAp">üëé With GCP we can&#x27;t attain full functional isolation</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Building Code: Kubernetes</h2></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#7C7C7C"># Build the image</span>
docker build --pull -t release-20180513-081033 \
  --build-arg NODE_ENV<span class="token" style="color:#EDEDED">=</span>production \
  --build-arg WEBUI_SHA<span class="token" style="color:#EDEDED">=</span><span class="token" style="color:#C6C5FE"><span class="token" style="color:#C6C5FE">$(</span><span class="token" style="color:#DAD085">git</span> rev-parse HEAD<span class="token" style="color:#C6C5FE">)</span></span> \
  --build-arg WEBUI_BUILD_DATE<span class="token" style="color:#EDEDED">=</span><span class="token" style="color:#C6C5FE"><span class="token" style="color:#C6C5FE">$(</span><span class="token" style="color:#DAD085">date</span> -u<span class="token" style="color:#C6C5FE">)</span></span>
<span class="token" style="color:#7C7C7C"># Publish it to the container registry, so Kubernetes (and anything else)</span>
<span class="token" style="color:#7C7C7C"># can find it</span>
docker push gitlab-registry.nordstrom.com/webui/release-20180513-081033
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Pros</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç Incremental builds in docker are fast (unchanged layers aren&#x27;t rebuilt)</li><li class="sc-hSdWYo bIQQAp">üëç Artifact tagging mechanism</li><li class="sc-hSdWYo bIQQAp">üëç Artifact repository provided (easy rollbacks, etc)</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cons</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé Docker tags aren&#x27;t immutable</li><li class="sc-hSdWYo bIQQAp">üëé While incremental builds are easy, the artifacts get big fast</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Building Code: Google Cloud Functions</h2><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">NODE_ENV<span class="token" style="color:#EDEDED">=</span>production
WEBUI_SHA<span class="token" style="color:#EDEDED">=</span><span class="token" style="color:#C6C5FE"><span class="token" style="color:#C6C5FE">$(</span><span class="token" style="color:#DAD085">git</span> rev-parse HEAD<span class="token" style="color:#C6C5FE">)</span></span>
WEBUI_BUILD_DATE<span class="token" style="color:#EDEDED">=</span><span class="token" style="color:#C6C5FE"><span class="token" style="color:#C6C5FE">$(</span><span class="token" style="color:#DAD085">date</span> -u<span class="token" style="color:#C6C5FE">)</span></span>
<span class="token" style="color:#7C7C7C"># That&#x27;s all folks!</span>
webpack
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Pros</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç It&#x27;s dead simple, as there&#x27;s nothing besides the code</li><li class="sc-hSdWYo bIQQAp">üëç Static artifacts are hosted in GCP object storage (let Google&#x27;s infrastructure serve those
assets for you)</li><li class="sc-hSdWYo bIQQAp">üëç Google keeps old versions of your code in GCP object storage for you</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cons</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé No sharing / incremental nature to builds (they&#x27;ll be a little slower, and possibly take up
more space if you&#x27;re storing a lot of them)</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Deploying Code: Kubernetes</h2><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token,key" style="color:#F9EE98">apiVersion</span><span class="token" style="color:#c5c8c6">:</span> apps/v1
<span class="token,key" style="color:#F9EE98">kind</span><span class="token" style="color:#c5c8c6">:</span> Deployment
<span class="token,key" style="color:#F9EE98">metadata</span><span class="token" style="color:#c5c8c6">:</span>
  <span class="token,key" style="color:#F9EE98">name</span><span class="token" style="color:#c5c8c6">:</span> webui
  <span class="token,key" style="color:#F9EE98">labels</span><span class="token" style="color:#c5c8c6">:</span>
    <span class="token,key" style="color:#F9EE98">app</span><span class="token" style="color:#c5c8c6">:</span> webui
<span class="token,key" style="color:#F9EE98">spec</span><span class="token" style="color:#c5c8c6">:</span>
  <span class="token,key" style="color:#F9EE98">replicas</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#FF73FD">3</span>
  <span class="token,key" style="color:#F9EE98">selector</span><span class="token" style="color:#c5c8c6">:</span>
    <span class="token,key" style="color:#F9EE98">matchLabels</span><span class="token" style="color:#c5c8c6">:</span>
      <span class="token,key" style="color:#F9EE98">app</span><span class="token" style="color:#c5c8c6">:</span> webui
  <span class="token" style="color:#c5c8c6">...</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">    <span class="token,key" style="color:#F9EE98">spec</span><span class="token" style="color:#c5c8c6">:</span>
      <span class="token,key" style="color:#F9EE98">containers</span><span class="token" style="color:#c5c8c6">:</span>
        <span class="token" style="color:#c5c8c6">-</span> <span class="token,key" style="color:#F9EE98">name</span><span class="token" style="color:#c5c8c6">:</span> webui
          <span class="token,key" style="color:#F9EE98">image</span><span class="token" style="color:#c5c8c6">:</span> gitlab<span class="token" style="color:#c5c8c6">-</span>registry.nordstrom.com/webui<span class="token" style="color:#c5c8c6">:</span>%SHA%
          <span class="token,key" style="color:#F9EE98">resources</span><span class="token" style="color:#c5c8c6">:</span>
            <span class="token,key" style="color:#F9EE98">requests</span><span class="token" style="color:#c5c8c6">:</span>
              <span class="token,key" style="color:#F9EE98">cpu</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#FF73FD">1</span>
              <span class="token,key" style="color:#F9EE98">memory</span><span class="token" style="color:#c5c8c6">:</span> 128Mi
          <span class="token,key" style="color:#F9EE98">ports</span><span class="token" style="color:#c5c8c6">:</span>
            <span class="token" style="color:#c5c8c6">-</span> <span class="token,key" style="color:#F9EE98">containerPort</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#FF73FD">3000</span>
          <span class="token,key" style="color:#F9EE98">livenessProbe</span><span class="token" style="color:#c5c8c6">:</span>
            <span class="token,key" style="color:#F9EE98">httpGet</span><span class="token" style="color:#c5c8c6">:</span>
              <span class="token,key" style="color:#F9EE98">path</span><span class="token" style="color:#c5c8c6">:</span> /health
              <span class="token,key" style="color:#F9EE98">port</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#FF73FD">3000</span>
              <span class="token,key" style="color:#F9EE98">scheme</span><span class="token" style="color:#c5c8c6">:</span> HTTPS
            <span class="token,key" style="color:#F9EE98">initialDelaySeconds</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#FF73FD">5</span>
            <span class="token,key" style="color:#F9EE98">periodSeconds</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#FF73FD">30</span>
            <span class="token" style="color:#c5c8c6">...</span>
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">            <span class="token" style="color:#c5c8c6">...</span>
            <span class="token,key" style="color:#F9EE98">envFrom</span><span class="token" style="color:#c5c8c6">:</span>
              <span class="token" style="color:#c5c8c6">-</span> <span class="token,key" style="color:#F9EE98">configMapRef</span><span class="token" style="color:#c5c8c6">:</span>
                  <span class="token,key" style="color:#F9EE98">name</span><span class="token" style="color:#c5c8c6">:</span> webui<span class="token" style="color:#c5c8c6">-</span>env
              <span class="token" style="color:#c5c8c6">-</span> <span class="token,key" style="color:#F9EE98">secretRef</span><span class="token" style="color:#c5c8c6">:</span>
                  <span class="token,key" style="color:#F9EE98">name</span><span class="token" style="color:#c5c8c6">:</span> webui<span class="token" style="color:#c5c8c6">-</span>env
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token,key" style="color:#F9EE98">kind</span><span class="token" style="color:#c5c8c6">:</span> Service
<span class="token,key" style="color:#F9EE98">apiVersion</span><span class="token" style="color:#c5c8c6">:</span> v1
<span class="token,key" style="color:#F9EE98">metadata</span><span class="token" style="color:#c5c8c6">:</span>
  <span class="token,key" style="color:#F9EE98">name</span><span class="token" style="color:#c5c8c6">:</span> webui
<span class="token,key" style="color:#F9EE98">spec</span><span class="token" style="color:#c5c8c6">:</span>
  <span class="token,key" style="color:#F9EE98">selector</span><span class="token" style="color:#c5c8c6">:</span>
    <span class="token,key" style="color:#F9EE98">app</span><span class="token" style="color:#c5c8c6">:</span> webui
  <span class="token,key" style="color:#F9EE98">ports</span><span class="token" style="color:#c5c8c6">:</span>
    <span class="token" style="color:#c5c8c6">-</span> <span class="token,key" style="color:#F9EE98">protocol</span><span class="token" style="color:#c5c8c6">:</span> TCP
      <span class="token,key" style="color:#F9EE98">port</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#FF73FD">80</span>
      <span class="token,key" style="color:#F9EE98">targetPort</span><span class="token" style="color:#c5c8c6">:</span> <span class="token" style="color:#FF73FD">3000</span>
  <span class="token,key" style="color:#F9EE98">type</span><span class="token" style="color:#c5c8c6">:</span> LoadBalancer
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#7C7C7C"># Connect to the Kubernetes Cluster</span>
gcloud container clusters get-credentials cluster-1 --region<span class="token" style="color:#EDEDED">=</span>us-west1
<span class="token" style="color:#7C7C7C"># Set the namespace for every kubectl command that follows</span>
kubectl config set-context <span class="token" style="color:#c5c8c6">(</span>kubectl config current-context<span class="token" style="color:#c5c8c6">)</span> --namespace<span class="token" style="color:#EDEDED">=</span>webui
<span class="token" style="color:#7C7C7C"># Set the version of our container that we want to deploy</span>
<span class="token" style="color:#DAD085">sed</span> -i <span class="token" style="color:#DAD085">sed</span> -i <span class="token" style="color:#A8FF60">&quot;s/%SHA%/<span class="token" style="color:#C6C5FE">$DOCKER_IMAGE_SHA</span>/&quot;</span> <span class="token" style="color:#A8FF60">&quot;<span class="token" style="color:#C6C5FE">$DEPLOYMENT_CFG_FILE</span>&quot;</span>
<span class="token" style="color:#7C7C7C"># Deploy! Kubernetes figures out what to do</span>
kubectl apply -f config.yml
<span class="token" style="color:#7C7C7C"># Block until it&#x27;s done, and print out the status as things occur</span>
kubectl rollout status -w deployments webui
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Pros</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç Lots of control / customization of the deployment mechanism</li><li class="sc-hSdWYo bIQQAp">üëç Declarative configuration expressed in code, for everything from the actual instances to the
loadbalancer (all of which works locally, too!)</li><li class="sc-hSdWYo bIQQAp">üëç Easy to pause a deployment, rollback, or even deploy a prior version</li><li class="sc-hSdWYo bIQQAp">üëç Baked in secret and configuration management (and the fact that they&#x27;re different is a step
in the right direction)</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cons</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé Requires a lot of configuration, and considerable ramp-up for developers</li><li class="sc-hSdWYo bIQQAp">üëé There are bugs (though they&#x27;re usually fixed very quickly)</li><li class="sc-hSdWYo bIQQAp">üëé It&#x27;s a big API, there&#x27;s lots of ways to do the same thing</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Deploying Code: Google Cloud Functions</h2></div></div><div class="sc-htoDjs zIEGn"><div><p class="sc-kEYyzF fhSvky" font-size="2">First, ship your assets to object storage so you can let Google do the heavy lifting üí™ there:</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#7C7C7C"># Ship our assets up to the cloud</span>
gsutil <span class="token" style="color:#DAD085">cp</span> -r <span class="token" style="color:#A8FF60">&quot;./static&quot;</span> gs://webui-assets
<span class="token" style="color:#7C7C7C"># Give everyone access to it</span>
gsutil acl ch -ur AllUsers:R gs://webui-assets
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><p class="sc-kEYyzF fhSvky" font-size="2">Then, deploy that cloud function!</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#7C7C7C"># It&#x27;s literally that simple</span>
gcloud functions deploy dist/server.js \
  --runtime nodejs8 \
  --trigger-http \
  --set-env-var NODE_ENV<span class="token" style="color:#EDEDED">=</span>production \
  --set-env-var STATIC_ORIGIN<span class="token" style="color:#EDEDED">=</span>https://storage.googleapis.com/webui-assets \
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Pros</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç Dead simple</li><li class="sc-hSdWYo bIQQAp">üëç Google handles the hard stuff for us (zero downtime, etc)</li></ul><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cons</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé Some advanced orchestration mechanics (like canary deploys) require a bit more coordination /
work</li><li class="sc-hSdWYo bIQQAp">üëé No secret management mechanism built in. Could use environment variables, but that&#x27;s discouraged
due to the fact that it could cause them to inadvertendly be leaked / logged.</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Metrics, Monitoring and Observability: Kubernetes</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Great metrics for free!</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Pod CPU and memory usage</li><li class="sc-hSdWYo bIQQAp">Requests, by status code</li><li class="sc-hSdWYo bIQQAp">Request latency</li></ul><img src="/k8s-metrics.png" width="800"/></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Perusing your sunday morning request logs:</h2><p class="sc-kEYyzF fhSvky" font-size="2">Standard out can easily be sent to Google&#x27;s Stackdriver service, and viewed with the <code class="sc-jWBwVP jKjVCu" color="code">kubectl log</code>
command line API.</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:#7C7C7C"># Read all logs on k8s for a given pod</span>
kubectl logs pod/webui
<span class="token" style="color:#7C7C7C"># Pipe them to your favorite shell utility and work wizardry ‚ú®</span>
kubectl logs pod/webui <span class="token" style="color:#EDEDED">|</span> <span class="token" style="color:#DAD085">grep</span> <span class="token" style="color:#A8FF60">&#x27;Error&#x27;</span>
<span class="token" style="color:#7C7C7C"># Follow them!</span>
kubectl -f logs pod/webui`
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Bug sleuthing:</h2><p class="sc-kEYyzF fhSvky" font-size="2">If something fishy üêü is happening, we can debug via a shell running in a specific pod:</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">kubectl <span class="token" style="color:#DAD085">exec</span> -it pod/webui -- /bin/sh
<span class="token" style="color:#EDEDED">&gt;</span> <span class="token" style="color:#DAD085">env</span> <span class="token" style="color:#EDEDED">|</span> <span class="token" style="color:#DAD085">grep</span> <span class="token" style="color:#A8FF60">&#x27;SUPER_SECRET_API_KEY&#x27;</span>
SUPER_SECRET_API_KEY<span class="token" style="color:#EDEDED">=</span>≈ö√ôP3R_≈†√ãCR3TS
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Pros</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç Powerful, well-documented and ever-improving command line toolset</li><li class="sc-hSdWYo bIQQAp">üëç Familiar to operators and developers, which makes debugging tricky situations easier</li></ul><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cons</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé Log aggregation requires a bit of work on your part when setting up the cluster</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Metrics, Monitoring and Observability: Google Cloud Functions</h2></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Google gives metrics specific to the invocations:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Timeouts</li><li class="sc-hSdWYo bIQQAp">Errors</li><li class="sc-hSdWYo bIQQAp">Invocation count</li><li class="sc-hSdWYo bIQQAp">Runtime duration</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Logs, logs and more logs:</h2><p class="sc-kEYyzF fhSvky" font-size="2">Logs are automatically aggregated using Stackdriver, and can be viewed via a command line API as
well:</p><pre style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:.5em 0;overflow:auto;border-radius:0.3em;background:#1d1f21"><code style="color:#c5c8c6;text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:Inconsolata, Monaco, Consolas, &#x27;Courier New&#x27;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none">gcloud functions logs <span class="token" style="color:#DAD085">read</span> webui
gcloud functions logs <span class="token" style="color:#DAD085">read</span> webui --execution-id EXECUTION_ID
</code></pre></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Pros</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëç Logs automatically aggregated and readable via command line API</li><li class="sc-hSdWYo bIQQAp">üëç Built in ability to view a particular execution&#x27;s logs is effectively a free form of tracing
/ would require instrumentation in Kubernetes to duplicate.</li></ul><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cons</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">üëé Can&#x27;t live debug (but do we really need that?)</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cold Starts</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">There&#x27;s a lot of talk about them</li><li class="sc-hSdWYo bIQQAp">Google says you shouldn&#x27;t worry about them: <br/><em>
&quot;If your function receives steady load, however, then the number of cold starts is typically
negligible unless your function frequently crashes and requires restarting of the function
environment&quot;</em></li></ul></div></div><div class="sc-htoDjs zIEGn"><div><p class="sc-kEYyzF fhSvky" font-size="2">TODO: Cold Start Test</p></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Cost</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Kubernetes ~$30 per pod, per month (~$120 / month for our setup)</li><li class="sc-hSdWYo bIQQAp">Cloud Functions: ~$20 / month (for 2,000,000 invocations)</li><li class="sc-hSdWYo bIQQAp">With Cloud Functions you only pay for what you use, which could yield big savings (services with
little or irregular traffic)</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">So, who wins?</h2></div></div><div class="sc-htoDjs zIEGn"><div><h1 class="sc-jzJRlG enxKql sc-fjdhpX dYzIWH" font-size="4" color="heading"><code class="sc-jWBwVP jKjVCu" color="code">¬Ø\_(„ÉÑ)_/¬Ø</code></h1></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">The &quot;Kase&quot; for Kubernetes</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">More powerful for operators</li><li class="sc-hSdWYo bIQQAp">Lots of flexibility (cronjobs, web services, etc), though this may be a double edge sword ‚öîÔ∏è...</li><li class="sc-hSdWYo bIQQAp">More familiar to developers</li><li class="sc-hSdWYo bIQQAp">It&#x27;s open, the source code is something your organization can look at, contribute to, etc</li><li class="sc-hSdWYo bIQQAp">Full control of execution environment allows fine grained control of latency</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Favoring Functions</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Pay for what you use could save your organization a lot of money with certain types of services</li><li class="sc-hSdWYo bIQQAp">You get a lot more &quot;out of the box&quot; so there&#x27;s less ramp up for your team</li><li class="sc-hSdWYo bIQQAp">Fully abstracted solution that&#x27;s &quot;infinitely scalable, literally no members of your organization
have to think about infrastructure</li><li class="sc-hSdWYo bIQQAp">Requires a bit of a shift in mindset for engineers, but really isn&#x27;t that bad</li><li class="sc-hSdWYo bIQQAp">One can expect Google to add a lot of new functionality in the near future</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">There are things you shouldn&#x27;t do with Cloud Function:</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp"><strong>Really</strong> latency sensitive services</li><li class="sc-hSdWYo bIQQAp">Run code that depends on (fast) disk i/o</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h2 class="sc-kAzzGY jHprQs sc-cSHVUG bJSzQT" font-size="3" color="heading">Use what works...</h2><ul class="sc-kkGfuU hISnYn" font-size="2"><li class="sc-hSdWYo bIQQAp">Both are great choices, and miles better than the ways we&#x27;ve solved this problem in the past.</li><li class="sc-hSdWYo bIQQAp">Use what makes sense for you, your team and your organization</li><li class="sc-hSdWYo bIQQAp">Invest in devops, reflect on what you learn, and share with others!</li></ul></div></div><div class="sc-htoDjs zIEGn"><div><h1 class="sc-jzJRlG enxKql sc-fjdhpX dYzIWH" font-size="4" color="heading">üëã Thanks Denver!</h1><h3 class="sc-kgoBCf kVSTZj sc-chPdSV gjsVpB" font-size="2" color="heading">@codeviking</h3><h3 class="sc-kgoBCf kVSTZj sc-chPdSV gjsVpB" font-size="2" color="heading"><a class="sc-hMqMXs bBrRcM" href="http://careers.nordstrom.com" color="link">http://careers.nordstrom.com</a></h3><h3 class="sc-kgoBCf kVSTZj sc-chPdSV gjsVpB" font-size="2" color="heading">sam.skjonsberg@nordstrom.com</h3></div></div></div></div></div></div><div class="sc-htpNat cXgiMa"><div class="sc-bdVaJa eCoqJu"><button class="sc-bwzfXH kaUAEP" title="go to: 0" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 1" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 2" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 3" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 4" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 5" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 6" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 7" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 8" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 9" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 10" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 11" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 12" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 13" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 14" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 15" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 16" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 17" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 18" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 19" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 20" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 21" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 22" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 23" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 24" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 25" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 26" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 27" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 28" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 29" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 30" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 31" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 32" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 33" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 34" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 35" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 36" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 37" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 38" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 39" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 40" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 41" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 42" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 43" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 44" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 45" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 46" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 47" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 48" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 49" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 50" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 51" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 52" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 53" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 54" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 55" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 56" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 57" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 58" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 59" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 60" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 61" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 62" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 63" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 64" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 65" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 66" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 67" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 68" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 69" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 70" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 71" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 72" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 73" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 74" color="text"></button><button class="sc-bwzfXH gtARdA" title="go to: 75" color="text"></button></div></div><div class="sc-ifAKCX hOCGEu sc-bxivhb fbxTAJ" role="button" title="Previous Slide"></div><div class="sc-EHOje bNhvRs sc-bxivhb fbxTAJ" role="button" title="Next Slide"></div></div>
<script src="main.js"></script>
</body>
</html>
